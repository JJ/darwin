<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Darwin Neuroevolution Framework: Python Bindings for Darwin: Tutorial</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Darwin Neuroevolution Framework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Python Bindings for Darwin: Tutorial </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li><a href="#a-first-example">A first example</a><ul>
<li><a href="#opening-or-creating-a-darwin-universe">Opening or creating a Darwin universe</a></li>
<li><a href="#selecting-and-configuring-a-population">Selecting and configuring a Population</a></li>
<li><a href="#selecting-and-configuring-a-domain">Selecting and configuring a Domain</a></li>
<li><a href="#creating-a-new-experiment">Creating a new Experiment</a></li>
<li><a href="#evolve">Evolve!</a></li>
</ul>
</li>
<li><a href="#darwinpropertyset">darwin.PropertySet</a></li>
<li><a href="#darwingenerationsummary">darwin.GenerationSummary</a></li>
<li><a href="#darwintrace">darwin.Trace</a></li>
</ul>
<h2>A first example</h2>
<p>The following example illustrates the key objects and evolution cycle:</p>
<div class="fragment"><div class="line">import darwin</div><div class="line"></div><div class="line"># opens (or creates) a Darwin universe database</div><div class="line">universe = darwin.open_universe(&#39;example.darwin&#39;)</div><div class="line"></div><div class="line"># select a population</div><div class="line">population = darwin.Population(&#39;neat&#39;)</div><div class="line">population.size = 1000</div><div class="line"></div><div class="line"># select a domain</div><div class="line">domain = darwin.Domain(&#39;unicycle&#39;)</div><div class="line"></div><div class="line"># create a new experiment</div><div class="line">experiment = universe.new_experiment(domain, population)</div><div class="line"></div><div class="line"># basic evolution cycle</div><div class="line">experiment.initialize_population()</div><div class="line">for generation in range(10):</div><div class="line">    print(f&#39;Generation {generation} ...&#39;)</div><div class="line"></div><div class="line">    summary = experiment.evaluate_population()</div><div class="line">    print(f&#39;  best fitness={summary.best_fitness:.3f}&#39;)</div><div class="line">    print(f&#39;  median fitness={summary.median_fitness:.3f}&#39;)</div><div class="line">    print(f&#39;  worst fitness={summary.worst_fitness:.3f}&#39;)</div><div class="line">    print()</div><div class="line"></div><div class="line">    experiment.create_next_generation()</div></div><!-- fragment --><p>Running this piece of code should produce something like this:</p>
<div class="fragment"><div class="line">Generation 0 ...</div><div class="line">  best fitness=0.295</div><div class="line">  median fitness=0.014</div><div class="line">  worst fitness=0.013</div><div class="line"></div><div class="line">Generation 1 ...</div><div class="line">  best fitness=0.729</div><div class="line">  median fitness=0.049</div><div class="line">  worst fitness=0.012</div><div class="line"></div><div class="line">Generation 2 ...</div><div class="line">  best fitness=1.600</div><div class="line">  median fitness=0.078</div><div class="line">  worst fitness=0.012</div><div class="line"></div><div class="line">...</div></div><!-- fragment --><p>The rest of the tutorial will break down this example and explain the key parts.</p>
<h3>Opening or creating a Darwin universe</h3>
<p>In the Darwin Framework, all the experiment variations and runs are recorded in a <a href="https://github.com/tlemo/darwin#running-experiments--the-universe-database">universe database</a>, so one of the first things we need to do is open or create a <a class="el" href="classdarwin_1_1_universe.html" title="The persistent storage for all the experiments and variations. ">darwin.Universe</a> instance:</p>
<div class="fragment"><div class="line"># opens (or creates) a Darwin universe database</div><div class="line">universe = darwin.open_universe(&#39;example.darwin&#39;)</div></div><!-- fragment --><p>A universe may be explicitly closed using <code>universe.close()</code>, or using the <code>with</code> statement:</p>
<div class="fragment"><div class="line">with darwin.open_universe(path) as universe:</div><div class="line">    ...</div></div><!-- fragment --><blockquote class="doxtable">
<p>IMPORTAT: Don't close the universe while there are active experiments using </p>
</blockquote>
<p>it. This will likely result in a crash the next time the experiment will try to write to the database.</p>
<h3>Selecting and configuring a Population</h3>
<p>In order to setup an experiment, we need a <em>Population</em>, which abstracts a particular type of Evolutionary Algoritm, ex. Conventional Neuroevolution (CNE) or NEAT. A population is a fixed length collection of genotypes (solution recipes)</p>
<p>Here we're instantiating a 'neat' population type and set its size to <code>1000</code> genotypes:</p>
<div class="fragment"><div class="line">population = darwin.Population(&#39;neat&#39;)</div><div class="line">population.size = 1000</div></div><!-- fragment --><p><code>available_populations()</code> returns a list with the names of all available population types:</p>
<div class="fragment"><div class="line">&gt;&gt;&gt; darwin.available_populations()</div><div class="line">[&#39;cgp&#39;, &#39;cne.feedforward&#39;, &#39;cne.full_rnn&#39;, &#39;cne.lstm&#39;, &#39;cne.lstm_lite&#39;, &#39;cne.rnn&#39;, &#39;neat&#39;, &#39;test_population&#39;]</div></div><!-- fragment --><p>Besides the size, each population type has a number of configuration knobs, exposed through the <code>.config</code> attribute, which is a dictionary-like object. Each Population is created with a sensible set of defaults, although for real experiments we may want to tweak the values.</p>
<blockquote class="doxtable">
<p>NOTE: Each Population type has its specific set of configuration knobs. </p>
</blockquote>
<p>Finally, a Population, once initialized (<code>experiment.initialize_population()</code>), can be indexed and iterated over (the genotypes in a population are always sorted in descending fitness order)</p>
<div class="fragment"><div class="line">genotype = population[0] # this is the genotype with the best fitness value</div><div class="line">...</div><div class="line">for genotype in population:</div><div class="line">    ...</div></div><!-- fragment --><h3>Selecting and configuring a Domain</h3>
<p>Domains abstract the problem space and provides the details on how to evaluate and assign fitness values to each genotype in a Population.</p>
<div class="fragment"><div class="line">domain = darwin.Domain(&#39;unicycle&#39;)</div></div><!-- fragment --><p>The set of available domains can be discovered using <code>avaiable_domains()</code>:</p>
<div class="fragment"><div class="line">&gt;&gt;&gt; darwin.available_domains()</div><div class="line">[&#39;ballistics&#39;, &#39;car_track&#39;, &#39;cart_pole&#39;, &#39;conquest&#39;, &#39;double_cart_pole&#39;, &#39;drone_follow&#39;, &#39;drone_track&#39;, &#39;drone_vision&#39;, &#39;find_max_value&#39;, &#39;harvester&#39;, &#39;pong&#39;, &#39;test_domain&#39;, &#39;tic_tac_toe&#39;, &#39;unicycle&#39;]</div></div><!-- fragment --><p>Similar to Populations, each Domain type exposes a specific set of configuration knobs through the <code>config</code> attribute.</p>
<h3>Creating a new Experiment</h3>
<p>Domains and Populations don't know anything about each other, which is how Darwin Framework can run NxM combinations with only N Domains + M Populations.</p>
<p>The Experiment object encapsulates a particular Domain, Population combination:</p>
<div class="fragment"><div class="line">experiment = universe.new_experiment(domain, population)</div></div><!-- fragment --><p>Experiments also have a <code>.config</code> attribute, plus a <code>.core_config</code> attribute with even more knobs common to most Populations.</p>
<ul>
<li><code>experiment.trace</code> returns the trace of the current run, once the experiment is initialed (see <code>darwin.Trace</code>)</li>
<li><code>experiment.reset()</code> will terminate the current evolution run, allowing the configuration values to be changed again.</li>
</ul>
<h3>Evolve!</h3>
<p>The whole point of setting up the <em>Population</em> and the <em>Domain</em> and putting them together as an <em>Experiment</em>, is to search for solutions (models) using an <a href="https://github.com/tlemo/darwin#evolutionary-algorithms-and-neuroevolution"><em>Evolutionary Algorithm</em></a>.</p>
<p>The general structure of an evolution loop is simple enough:</p>
<div class="fragment"><div class="line">experiment.initialize_population() # (1)</div><div class="line">for generation in range(10):</div><div class="line">    summary = experiment.evaluate_population() # (2)</div><div class="line">    experiment.create_next_generation() # (3)</div></div><!-- fragment --><ol type="1">
<li>Initialize the population with random genotypes. This step also marks the experiment as "active" - which means that it starts being recorded to the universe database. The configuration values can't be changed anymore (this include Population and Domain configurations)</li>
<li>Evaluate the population, using the Domain instance to assign fitness values to every genotype in the population. <code>evaluate_population()</code> returns a <code><a class="el" href="structdarwin_1_1_generation_summary.html" title="Summary of a generation (fitness samples, best genotype, ...) ">darwin.GenerationSummary</a></code> object.</li>
<li>Create a new generation, starting from the current population with the fitness values set at step 2 (<code>evaluate_population()</code> must be called before <code>create_next_generation()</code>)</li>
</ol>
<h2>darwin.PropertySet</h2>
<p>The configuration knobs for Populations, Domains and Experiments are dictionary-like objects of type <code>darwin.PropertySet</code>:</p>
<ul>
<li><code>str(property_set)</code> returns a string representation of all the values in a property set (useful to discover the set of knobs/values)</li>
<li><code>dir(property_set)</code> returns a list of all the properties in a property set</li>
<li><code>darwin.PropertySet.to_json()</code> returns a JSON string representation of the property set</li>
<li><code>darwin.PropertySet.from_json(json_string)</code> will update the property set from the <code>json_string</code>, which is a JSON string.</li>
</ul>
<h2><a class="el" href="structdarwin_1_1_generation_summary.html" title="Summary of a generation (fitness samples, best genotype, ...) ">darwin.GenerationSummary</a></h2>
<p><code><a class="el" href="structdarwin_1_1_generation_summary.html" title="Summary of a generation (fitness samples, best genotype, ...) ">darwin.GenerationSummary</a></code> records key values after a Population evaluation:</p>
<ul>
<li><code><a class="el" href="structdarwin_1_1_generation_summary.html#ab47b2a121aa1a21f0af916fd07c08e25" title="Generation number. ">darwin.GenerationSummary.generation</a></code></li>
<li><code><a class="el" href="structdarwin_1_1_generation_summary.html#ab9817a41556270efa5bc37f18c332a9a" title="Best fitness value. ">darwin.GenerationSummary.best_fitness</a></code></li>
<li><code><a class="el" href="structdarwin_1_1_generation_summary.html#a8b2b3ce6c1d3f2a1a2165c81474404a6" title="Median fitness value. ">darwin.GenerationSummary.median_fitness</a></code></li>
<li><code><a class="el" href="structdarwin_1_1_generation_summary.html#a715af27b1d4e8d82f4666de3c86c51ce" title="Worst fitness value. ">darwin.GenerationSummary.worst_fitness</a></code></li>
<li><code><a class="el" href="structdarwin_1_1_generation_summary.html#a3c3b5cda2b5f53a35ecb8709d3166fb3" title="Best genotype in the generation. ">darwin.GenerationSummary.champion</a></code> - best genotype in the generation</li>
<li><code><a class="el" href="structdarwin_1_1_generation_summary.html#a4967725e35263dee9c5ad723af01023a" title="Calibration fitness values. ">darwin.GenerationSummary.calibration_fitness</a></code> - domain specific scores against reference baselines (ex. a random agent)</li>
</ul>
<h2>darwin.Trace</h2>
<p><code>darwin.Trace</code> is a recording of all the generations in the current experiment, once started. It can be indexed and iterated over, returning the <code>GenerationSummary</code> for all completed generations. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
